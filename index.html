<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SNIP — URL Shortener on Azure</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #070a0f;
    --surface: #0d1117;
    --surface2: #161c26;
    --border: #1e2a3a;
    --border2: #243040;
    --text: #cdd9e5;
    --muted: #546a7b;
    --accent: #00d4ff;
    --accent2: #00ff9d;
    --warn: #ffb800;
    --danger: #ff4444;
    --node: #5fa04e;
    --glow: 0 0 20px rgba(0,212,255,0.15);
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'IBM Plex Mono', monospace;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Scanline overlay */
  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px);
    pointer-events: none;
    z-index: 1000;
  }

  /* Grid background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,212,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,212,255,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
  }

  /* Header */
  header {
    border-bottom: 1px solid var(--border);
    padding: 0 2rem;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(7,10,15,0.92);
    backdrop-filter: blur(12px);
  }

  .logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.8rem;
    letter-spacing: 0.08em;
    color: var(--accent);
    text-shadow: 0 0 20px rgba(0,212,255,0.5);
  }
  .logo span { color: var(--text); }

  .node-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.72rem;
    color: var(--node);
    border: 1px solid rgba(95,160,78,0.3);
    padding: 4px 10px;
    border-radius: 4px;
    background: rgba(95,160,78,0.08);
  }
  .node-badge::before { content: '⬡'; font-size: 0.85rem; }

  /* Main */
  main { max-width: 900px; margin: 0 auto; padding: 2.5rem 1.5rem; }

  /* Hero */
  .hero { margin-bottom: 2.5rem; }
  .hero-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(3rem, 8vw, 5.5rem);
    line-height: 0.92;
    letter-spacing: 0.02em;
    color: var(--text);
    margin-bottom: 1rem;
  }
  .hero-title .hl { color: var(--accent); text-shadow: 0 0 30px rgba(0,212,255,0.4); }
  .hero-subtitle {
    font-size: 0.8rem;
    color: var(--muted);
    line-height: 1.7;
    max-width: 480px;
    border-left: 2px solid var(--accent);
    padding-left: 12px;
  }

  /* Feature pills */
  .features { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 1.2rem; }
  .feat {
    font-size: 0.68rem;
    padding: 4px 10px;
    border-radius: 3px;
    border: 1px solid;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 600;
  }
  .feat-blue { color: var(--accent); border-color: rgba(0,212,255,0.3); background: rgba(0,212,255,0.06); }
  .feat-green { color: var(--accent2); border-color: rgba(0,255,157,0.3); background: rgba(0,255,157,0.06); }
  .feat-yellow { color: var(--warn); border-color: rgba(255,184,0,0.3); background: rgba(255,184,0,0.06); }

  /* Input panel */
  .panel {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 1.5rem;
    box-shadow: var(--glow);
  }
  .panel-bar {
    background: var(--surface2);
    padding: 8px 16px;
    font-size: 0.7rem;
    color: var(--muted);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .panel-bar::before {
    content: '●  ●  ●';
    color: var(--border2);
    letter-spacing: 2px;
    margin-right: 8px;
  }
  .panel-body { padding: 1.5rem; }

  .input-grid {
    display: grid;
    grid-template-columns: 1fr auto auto;
    gap: 8px;
    align-items: start;
  }
  @media (max-width: 600px) { .input-grid { grid-template-columns: 1fr; } }

  .field { display: flex; flex-direction: column; gap: 5px; }
  .field label { font-size: 0.65rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.1em; }

  input[type="text"] {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.82rem;
    background: var(--bg);
    border: 1px solid var(--border2);
    border-radius: 5px;
    padding: 10px 12px;
    color: var(--text);
    outline: none;
    transition: border-color 0.15s, box-shadow 0.15s;
    width: 100%;
  }
  input[type="text"]:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 2px rgba(0,212,255,0.1);
  }
  input[type="text"]::placeholder { color: var(--muted); }

  button {
    font-family: 'IBM Plex Mono', monospace;
    font-weight: 600;
    font-size: 0.78rem;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    padding: 10px 16px;
    transition: all 0.15s;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    white-space: nowrap;
    align-self: flex-end;
  }
  .btn-accent {
    background: var(--accent);
    color: var(--bg);
  }
  .btn-accent:hover { filter: brightness(1.15); box-shadow: 0 0 16px rgba(0,212,255,0.35); }

  /* Links table */
  .table-wrap { overflow-x: auto; }
  table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
  th {
    text-align: left;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--muted);
    padding: 8px 12px;
    border-bottom: 1px solid var(--border);
    font-weight: 600;
  }
  td { padding: 10px 12px; border-bottom: 1px solid var(--border); vertical-align: middle; }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: rgba(0,212,255,0.03); }

  .code-cell {
    color: var(--accent);
    font-weight: 600;
    cursor: pointer;
    transition: text-shadow 0.15s;
  }
  .code-cell:hover { text-shadow: 0 0 10px rgba(0,212,255,0.6); }

  .url-cell {
    color: var(--muted);
    max-width: 220px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .hits-cell {
    color: var(--accent2);
    font-weight: 600;
    text-align: center;
  }

  .date-cell { color: var(--muted); font-size: 0.72rem; }

  .del-btn {
    background: none;
    color: var(--border2);
    font-size: 0.85rem;
    padding: 4px 8px;
    border-radius: 4px;
    transition: color 0.15s, background 0.15s;
  }
  .del-btn:hover { color: var(--danger); background: rgba(255,68,68,0.1); }

  .copy-btn {
    background: rgba(0,212,255,0.08);
    color: var(--accent);
    border: 1px solid rgba(0,212,255,0.2);
    font-size: 0.68rem;
    padding: 3px 8px;
    border-radius: 4px;
  }
  .copy-btn:hover { background: rgba(0,212,255,0.15); }
  .copy-btn.copied { color: var(--accent2); border-color: rgba(0,255,157,0.3); }

  .empty-row td {
    text-align: center;
    color: var(--muted);
    padding: 2rem;
    font-size: 0.78rem;
  }

  /* Health / info bar */
  .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  .info-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 14px 16px;
    animation: fadeUp 0.4s ease both;
  }
  .info-label { font-size: 0.62rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 4px; }
  .info-val { font-size: 0.88rem; font-weight: 600; color: var(--accent); }

  /* Toast */
  #toast {
    position: fixed;
    bottom: 1.5rem;
    right: 1.5rem;
    background: var(--surface2);
    border: 1px solid var(--accent);
    color: var(--accent);
    font-size: 0.78rem;
    padding: 10px 16px;
    border-radius: 6px;
    box-shadow: 0 0 20px rgba(0,212,255,0.2);
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.25s;
    pointer-events: none;
    z-index: 999;
  }
  #toast.show { opacity: 1; transform: translateY(0); }

  /* Animations */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  .row-enter { animation: fadeUp 0.25s ease both; }

  /* Node 22 callout */
  .node22-callout {
    background: linear-gradient(135deg, rgba(95,160,78,0.08), rgba(0,212,255,0.05));
    border: 1px solid rgba(95,160,78,0.25);
    border-radius: 6px;
    padding: 1rem 1.2rem;
    font-size: 0.75rem;
    line-height: 1.7;
    color: var(--muted);
    margin-bottom: 1.5rem;
  }
  .node22-callout strong { color: var(--node); }
  .node22-callout code {
    color: var(--accent);
    background: rgba(0,212,255,0.08);
    padding: 1px 5px;
    border-radius: 3px;
    font-size: 0.85em;
  }
</style>
</head>
<body>

<header>
  <div class="logo">SNIP<span>.</span></div>
  <div class="node-badge" id="node-version">Node 22 LTS</div>
</header>

<main>
  <div class="hero">
    <div class="hero-title">URL<br><span class="hl">SHORTENER</span></div>
    <p class="hero-subtitle">Demo app for Azure App Service. Showcases Node 22 LTS native features — no extra packages required.</p>
    <div class="features">
      <span class="feat feat-blue">ES Modules</span>
      <span class="feat feat-green">Native SQLite</span>
      <span class="feat feat-yellow">Native Fetch</span>
      <span class="feat feat-blue">Azure App Service</span>
    </div>
  </div>

  <!-- Node 22 callout -->
  <div class="node22-callout">
    <strong>⬡ Node 22 LTS Features Used:</strong><br>
    <strong>node:sqlite</strong> — built-in database, zero install. &nbsp;|&nbsp;
    <strong>Native fetch()</strong> — HTTP calls without <code>node-fetch</code> or <code>axios</code>. &nbsp;|&nbsp;
    <strong>ES Modules</strong> — <code>import/export</code> natively, no Babel needed. &nbsp;|&nbsp;
    <strong>--watch</strong> flag — built-in hot reload, no <code>nodemon</code> required.
  </div>

  <!-- Health info -->
  <div class="info-grid" id="info-grid">
    <div class="info-card"><div class="info-label">Status</div><div class="info-val" id="h-status">…</div></div>
    <div class="info-card"><div class="info-label">Node Version</div><div class="info-val" id="h-node">…</div></div>
    <div class="info-card"><div class="info-label">Environment</div><div class="info-val" id="h-env">…</div></div>
    <div class="info-card"><div class="info-label">Total Links</div><div class="info-val" id="h-links">…</div></div>
  </div>

  <!-- Input panel -->
  <div class="panel">
    <div class="panel-bar">NEW LINK — snip.azurewebsites.net/your-code</div>
    <div class="panel-body">
      <div class="input-grid">
        <div class="field">
          <label>Long URL</label>
          <input type="text" id="url-input" placeholder="https://example.com/very/long/url" />
        </div>
        <div class="field">
          <label>Custom code (optional)</label>
          <input type="text" id="code-input" placeholder="my-link" maxlength="30" style="width:160px" />
        </div>
        <button class="btn-accent" onclick="createLink()">→ SNIP</button>
      </div>
    </div>
  </div>

  <!-- Links table -->
  <div class="panel">
    <div class="panel-bar">ALL LINKS — <span id="link-count">0</span> total</div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Code</th>
            <th>Destination</th>
            <th style="text-align:center">Hits</th>
            <th>Created</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="links-body">
          <tr class="empty-row"><td colspan="5">Loading…</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</main>

<div id="toast"></div>

<script>
  const BASE = window.location.origin;

  async function loadLinks() {
    const res = await fetch('/api/links');
    const links = await res.json();
    document.getElementById('link-count').textContent = links.length;
    document.getElementById('h-links').textContent = links.length;
    const tbody = document.getElementById('links-body');
    if (!links.length) {
      tbody.innerHTML = '<tr class="empty-row"><td colspan="5">No links yet. Create one above!</td></tr>';
      return;
    }
    tbody.innerHTML = links.map(l => `
      <tr class="row-enter">
        <td>
          <span class="code-cell" onclick="copyShort('${l.code}')" title="Click to copy">${l.code}</span>
        </td>
        <td><div class="url-cell" title="${escHtml(l.url)}">${escHtml(l.url)}</div></td>
        <td class="hits-cell">${l.hits}</td>
        <td class="date-cell">${l.created?.split(' ')[0] ?? '—'}</td>
        <td>
          <button class="copy-btn" id="cp-${l.code}" onclick="copyShort('${l.code}')">copy</button>
          <button class="del-btn" onclick="deleteLink('${l.code}')">✕</button>
        </td>
      </tr>
    `).join('');
  }

  async function createLink() {
    const url  = document.getElementById('url-input').value.trim();
    const code = document.getElementById('code-input').value.trim();
    if (!url) return toast('⚠ Enter a URL first');
    const body = { url };
    if (code) body.code = code;
    const res = await fetch('/api/links', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });
    const data = await res.json();
    if (!res.ok) return toast('✕ ' + (data.error || 'Error'));
    document.getElementById('url-input').value = '';
    document.getElementById('code-input').value = '';
    await loadLinks();
    toast(`✓ Created: ${BASE}/${data.code}`);
  }

  async function deleteLink(code) {
    await fetch(`/api/links/${code}`, { method: 'DELETE' });
    loadLinks();
    toast('Deleted ' + code);
  }

  function copyShort(code) {
    const short = `${BASE}/${code}`;
    navigator.clipboard.writeText(short).then(() => {
      const btn = document.getElementById('cp-' + code);
      if (btn) { btn.textContent = 'copied!'; btn.classList.add('copied'); setTimeout(() => { btn.textContent = 'copy'; btn.classList.remove('copied'); }, 1500); }
      toast('Copied: ' + short);
    });
  }

  async function loadHealth() {
    const res = await fetch('/api/health');
    const d = await res.json();
    document.getElementById('h-status').textContent = d.status === 'ok' ? '● online' : '✕ error';
    document.getElementById('h-status').style.color = d.status === 'ok' ? 'var(--accent2)' : 'var(--danger)';
    document.getElementById('h-node').textContent = d.node;
    document.getElementById('h-env').textContent = d.environment;
    document.getElementById('node-version').textContent = d.node;
  }

  let toastTimer;
  function toast(msg) {
    const el = document.getElementById('toast');
    el.textContent = msg;
    el.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => el.classList.remove('show'), 2500);
  }

  function escHtml(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  document.getElementById('url-input').addEventListener('keydown', e => { if (e.key === 'Enter') createLink(); });

  loadHealth();
  loadLinks();
</script>
</body>
</html>
